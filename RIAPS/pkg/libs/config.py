import os
from dotenv import load_dotenv
load_dotenv()
MINER=os.getenv('CTRL')
print(MINER)
PORT = os.getenv('PORT')
print(PORT)
DSO_IP = os.getenv('DSO')
print(DSO_IP)
DSO_ADDRESS = 'tcp://%s:10001'%(os.getenv('DSO'))
GRID = os.getenv('GRID')

DATA_PATH = "libs/fifteenNode/"
TRANSACTION_GAS = "0x100000000"
BYTECODE = "0x60606040526000600360006101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506000600560006101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506000600760006101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600760086101000a81548167ffffffffffffffff021916908360070b67ffffffffffffffff16021790555034156100d957600080fd5b611c64806100e86000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063359bc19e1461008857806340d599c0146100b55780637f49f33c146101085780638375ced0146101355780639e52b99f1461019b578063a543c01814610214578063c37df44e14610254575b600080fd5b341561009357600080fd5b6100b3600480803567ffffffffffffffff169060200190919050506102ba565b005b34156100c057600080fd5b610106600480803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff16906020019091905050610729565b005b341561011357600080fd5b610133600480803567ffffffffffffffff169060200190919050506107a8565b005b341561014057600080fd5b610199600480803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff16906020019091905050610934565b005b34156101a657600080fd5b610212600480803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff16906020019091905050610ba3565b005b341561021f57600080fd5b610252600480803567ffffffffffffffff1690602001909190803567ffffffffffffffff16906020019091905050611910565b005b341561025f57600080fd5b6102b8600480803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff1690602001909190803567ffffffffffffffff169060200190919050506119c9565b005b600080600080600060109054906101000a900467ffffffffffffffff1667ffffffffffffffff168567ffffffffffffffff161415156102f857600080fd5b7fb7c84ee8cc759028af3805503fc9e6c5e3c93ed7a914a235e0a356d6521dc6af85600760089054906101000a900460070b604051808367ffffffffffffffff1667ffffffffffffffff1681526020018260070b60070b81526020019250505060405180910390a16000600760089054906101000a900460070b60070b1215156106db5760066000600760089054906101000a900460070b67ffffffffffffffff1667ffffffffffffffff1681526020019081526020016000209350600092505b8360010160009054906101000a900467ffffffffffffffff1667ffffffffffffffff168367ffffffffffffffff16101561068e578360000160008467ffffffffffffffff1667ffffffffffffffff1681526020019081526020016000209150600060109054906101000a900467ffffffffffffffff1667ffffffffffffffff168260000160109054906101000a900467ffffffffffffffff1667ffffffffffffffff161415610681578160000160189054906101000a900467ffffffffffffffff16905080600460008460000160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160188282829054906101000a900467ffffffffffffffff160392506101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555080600260008460000160089054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160188282829054906101000a900467ffffffffffffffff160392506101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055507f88e5e80941911913e9fc1294878a680b5990f203f56fb29c6e39bbd98e5d2b128260000160009054906101000a900467ffffffffffffffff168360000160089054906101000a900467ffffffffffffffff168460000160109054906101000a900467ffffffffffffffff168560000160189054906101000a900467ffffffffffffffff16604051808567ffffffffffffffff1667ffffffffffffffff1681526020018467ffffffffffffffff1667ffffffffffffffff1681526020018367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff16815260200194505050505060405180910390a15b82806001019350506103b9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600760086101000a81548167ffffffffffffffff021916908360070b67ffffffffffffffff1602179055505b6000601081819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550505050505050565b826000806101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555081600060086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555080600060106101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550505050565b6040805190810160405280600067ffffffffffffffff168152602001600067ffffffffffffffff1681525060066000600760009054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008201518160010160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060208201518160010160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055509050507f09a6f584fa54b80c174ca819878e0f4e3a6ae2416c51db61c0f275c45df68262600760009054906101000a900467ffffffffffffffff1682604051808367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff1681526020019250505060405180910390a16001600760008282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555050565b8167ffffffffffffffff168367ffffffffffffffff161115151561095757600080fd5b7fb0f09a7c285d588112f109144f5e334575b9cd0a6b1ec1c0a5ca6949ab815000600560009054906101000a900467ffffffffffffffff1685858585604051808667ffffffffffffffff1667ffffffffffffffff1681526020018567ffffffffffffffff1667ffffffffffffffff1681526020018467ffffffffffffffff1667ffffffffffffffff1681526020018367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff1681526020019550505050505060405180910390a16080604051908101604052808567ffffffffffffffff1681526020018467ffffffffffffffff1681526020018367ffffffffffffffff1681526020018267ffffffffffffffff16815250600460006005600081819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555067ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060208201518160000160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060408201518160000160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160000160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555090505050505050565b600080600080600760009054906101000a900467ffffffffffffffff1667ffffffffffffffff168967ffffffffffffffff16101515610be157600080fd5b600560009054906101000a900467ffffffffffffffff1667ffffffffffffffff168867ffffffffffffffff16101515610c1957600080fd5b600360009054906101000a900467ffffffffffffffff1667ffffffffffffffff168767ffffffffffffffff16101515610c5157600080fd5b600060109054906101000a900467ffffffffffffffff1667ffffffffffffffff168667ffffffffffffffff1610151515610c8a57600080fd5b600460008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160089054906101000a900467ffffffffffffffff1667ffffffffffffffff168667ffffffffffffffff1610151515610ceb57600080fd5b600460008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160109054906101000a900467ffffffffffffffff1667ffffffffffffffff168667ffffffffffffffff1611151515610d4c57600080fd5b600260008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160089054906101000a900467ffffffffffffffff1667ffffffffffffffff168667ffffffffffffffff1610151515610dad57600080fd5b600260008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160109054906101000a900467ffffffffffffffff1667ffffffffffffffff168667ffffffffffffffff1611151515610e0e57600080fd5b600660008a67ffffffffffffffff1667ffffffffffffffff168152602001908152602001600020935084925060016000600460008b67ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff16915060016000600260008a67ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff169050828460020160008a67ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550828460030160008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550848460040160008467ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550848460050160008367ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550600460008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160189054906101000a900467ffffffffffffffff1667ffffffffffffffff168460020160008a67ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff1667ffffffffffffffff16111515156111be57600080fd5b600260008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060000160189054906101000a900467ffffffffffffffff1667ffffffffffffffff168460030160008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff1667ffffffffffffffff161115151561125c57600080fd5b6000809054906101000a900467ffffffffffffffff1667ffffffffffffffff168460040160008467ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff1667ffffffffffffffff16111515156112f657600080fd5b6000809054906101000a900467ffffffffffffffff1667ffffffffffffffff168460050160008367ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff1667ffffffffffffffff161115151561139057600080fd5b600060089054906101000a900467ffffffffffffffff1667ffffffffffffffff168460050160008467ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff168560040160008567ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff160367ffffffffffffffff161115151561148f57600080fd5b600060089054906101000a900467ffffffffffffffff1667ffffffffffffffff168460050160008367ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008867ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff168560050160008467ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008967ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060009054906101000a900467ffffffffffffffff160367ffffffffffffffff161115151561158e57600080fd5b6080604051908101604052808967ffffffffffffffff1681526020018867ffffffffffffffff1681526020018767ffffffffffffffff1681526020018667ffffffffffffffff1681525084600001600086600101600081819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555067ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060208201518160000160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060408201518160000160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160000160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550905050848460010160088282829054906101000a900467ffffffffffffffff160192506101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506000600760089054906101000a900460070b60070b12806117e4575060066000600760089054906101000a900460070b67ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060010160089054906101000a900467ffffffffffffffff1667ffffffffffffffff168460010160089054906101000a900467ffffffffffffffff1667ffffffffffffffff16115b156118165788600760086101000a81548167ffffffffffffffff021916908360070b67ffffffffffffffff1602179055505b7f14b0a171ccbb9aa32b52104e2c28dd4f0ee751085858ad203c4eb8a8f2bbf77889898989898960010160089054906101000a900467ffffffffffffffff16604051808767ffffffffffffffff1667ffffffffffffffff1681526020018667ffffffffffffffff1667ffffffffffffffff1681526020018567ffffffffffffffff1667ffffffffffffffff1681526020018467ffffffffffffffff1667ffffffffffffffff1681526020018367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff168152602001965050505050505060405180910390a1505050505050505050565b80600160008467ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060006101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055507f07dd55c337918bf526aa38feaf559653854818d1399edf67d1dc230912123a3c8282604051808367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff1681526020019250505060405180910390a15050565b8167ffffffffffffffff168367ffffffffffffffff16111515156119ec57600080fd5b7f47be5dd1d9aeb3db0a9753c2d318b0140db2a5524856bd0b17bd92b4b1da8ede600360009054906101000a900467ffffffffffffffff1685858585604051808667ffffffffffffffff1667ffffffffffffffff1681526020018567ffffffffffffffff1667ffffffffffffffff1681526020018467ffffffffffffffff1667ffffffffffffffff1681526020018367ffffffffffffffff1667ffffffffffffffff1681526020018267ffffffffffffffff1667ffffffffffffffff1681526020019550505050505060405180910390a16080604051908101604052808567ffffffffffffffff1681526020018467ffffffffffffffff1681526020018367ffffffffffffffff1681526020018267ffffffffffffffff16815250600260006003600081819054906101000a900467ffffffffffffffff168092919060010191906101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555067ffffffffffffffff1667ffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060208201518160000160086101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060408201518160000160106101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555060608201518160000160186101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550905050505050505600a165627a7a72305820720abbcfb7fb621b6b7e3ede49f84cd18e2ed46719bb232dc1b144b41e6df5600029"

SOLVING_INTERVAL = 5 # seconds (how often MatchingSolverWrapper tries to solve the energy trading problem)
INTERVAL_LENGTH = 60 # seconds (how often the components move onto the next time interval)



START_INTERVAL = 33 # first time interval
END_INTERVAL = 79 # last time interval to solve.
# PREDICTION_WINDOW = END_INTERVAL-START_INTERVAL # how many time intervals ahead SmartHomeTraderWrapper trade (i.e., an offer is posted if offer['start'] <= time_interval + PREDICTION_WINDOW)
PREDICTION_WINDOW = 0

RATED_POWER = 7500 #watts
LOGICAL_INTERVAL = .25 #hrs
CAPACITY = 14000 #Wh

FEEDERS = []
PROSUMERS = []
PROSUMER_FEEDER = {}
for (feeder, num_prosumers) in [(1,5),(2,5),(3, 5)]:
    FEEDERS.append(feeder)
    for prosumer in range(1, num_prosumers + 1):
        prosumer_id = feeder * 100 + prosumer
        PROSUMERS.append(prosumer_id)
        PROSUMER_FEEDER[prosumer_id] = feeder

from libs.Microgrid import Microgrid
MICROGRID = Microgrid(
    interval_length=1.0,
    C_ext=20000000,
    C_int=25000000,
    feeders=FEEDERS,
    prosumer_feeder=PROSUMER_FEEDER)
